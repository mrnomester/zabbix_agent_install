### zabbix_agent_install
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Zabbix Agent –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Windows-—Ö–æ—Å—Ç–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Zabbix —á–µ—Ä–µ–∑ API.  
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:  
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≥–µ–Ω—Ç–∞ –∏–∑ MSI-–ø–∞–∫–µ—Ç–∞  
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ö–æ—Å—Ç–∞ –≤ Zabbix  
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏  
- –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫  

### ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞
–ó–∞–º–µ–Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ `agent+host_create.ps1`:  
```powershell
# –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã Zabbix
$ZBX_SERVER = "–≤–∞—à_IP_—Å–µ—Ä–≤–µ—Ä–∞"  # –ü—Ä–∏–º–µ—Ä: "192.168.1.100"
$ZBX_TOKEN = "–≤–∞—à_API_—Ç–æ–∫–µ–Ω"    # –°–æ–∑–¥–∞—Ç—å –≤ Zabbix: Administration ‚Üí API ‚Üí Tokens
$AGENT_MSI = "\\–≤–∞—à_—Å–µ—Ä–≤–µ—Ä\–ø—É—Ç—å\zabbix_agent-X.X.X.msi" # –í–µ—Ä—Å–∏—è 7.2.5+ 

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —à–∞–±–ª–æ–Ω–æ–≤
$ZBX_TEMPLATE_NAME = "Windows by Zabbix agent" # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ—á–Ω–æ–µ –∏–º—è
$ZBX_HOSTGRP_NAME = "Unassigned" # –ò–ª–∏ –≤–∞—à–∞ –≥—Ä—É–ø–ø–∞ —Ö–æ—Å—Ç–æ–≤
```

### üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- **PowerShell 5.1+**: –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞  
- **Zabbix API**: JSON-RPC –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ö–æ—Å—Ç–∞–º–∏  
- **Windows Installer (MSI)**: –ë–µ—Å—à–æ–≤–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≥–µ–Ω—Ç–∞  
- **Group Policy Objects**: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –¥–æ–º–µ–Ω–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è  
- **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**:  
  - –§–∞–π–ª–æ–≤–æ–µ: `C:\Windows\Temp\zabbix_script.log`  
  - Event Log: Application ‚Üí "Zabbix Script"  
- **–ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ FQDN**:  
  ```powershell
  $HOSTNAME = ([System.Net.Dns]::GetHostByName($env:computerName).HostName).tolower()
  ```

### üöÄ –ó–∞–ø—É—Å–∫
#### –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä):  
1. –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤:  
   ```powershell
   Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass -Force
   ```
2. –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞:  
   ```powershell
   \\—Å–µ—Ç–µ–≤–æ–π_–ø—É—Ç—å\agent+host_create.ps1
   ```

#### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ GPO:  
1. **–†–∞–∑–º–µ—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª—ã –≤ —Å–µ—Ç–µ–≤–æ–π –ø–∞–ø–∫–µ**:  
   - `agent+host_create.ps1`  

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–ª–∏—Ç–∏–∫—É (Computer Configuration)**:  
   - Policies ‚Üí Windows Settings ‚Üí Scripts ‚Üí Startup  
   - –î–æ–±–∞–≤—å—Ç–µ —Å–∫—Ä–∏–ø—Ç:  
     - **Script**: `%windir%\System32\WindowsPowerShell\v1.0\powershell.exe`  
     - **Parameters**: `-Noninteractive -ExecutionPolicy Bypass -Noprofile -file "\\—Å–µ—Ç–µ–≤–æ–π_–ø—É—Ç—å\agent+host_create.ps1"`

3. **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–ª–∏–µ–Ω—Ç–∞–º**:  
   - –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ç–µ–≤–æ–º—É —Ä–µ—Å—É—Ä—Å—É —Å MSI-—Ñ–∞–π–ª–æ–º  
   - –û—Ç–∫—Ä—ã—Ç—ã–π –ø–æ—Ä—Ç 10050 (–∏–ª–∏ –≤–∞—à –ø–æ—Ä—Ç –∞–≥–µ–Ω—Ç–∞)  
   - PowerShell 5.1+  

### üìå –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- **–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏**:  
  ```powershell
  $serviceNames = @("Zabbix Agent", "Zabbix Agent 2")
  if (Get-Service -Name $service -ErrorAction SilentlyContinue) { ... }
  ```
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å API**:  
  ```powershell
  $response = Invoke-RestMethod -Uri $ZBX_API -Method Post -Body $body -Headers @{ Authorization = "Bearer $ZBX_TOKEN" }
  ```
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ö–æ—Å—Ç–æ–≤**:  
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤  
  - –ü—Ä–∏–≤—è–∑–∫–∞ –∫ –≥—Ä—É–ø–ø–∞–º –∏ —à–∞–±–ª–æ–Ω–∞–º  
- **–ì–ª—É–±–æ–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**:  
  - –ó–∞–ø–∏—Å—å –≤ Event Log —Å –∫–æ–¥–æ–º 1  
  - –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –≤ –ª–æ–≥-—Ñ–∞–π–ª–µ  

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **API Token**:  
  - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞: `host.create` –≤ Zabbix  
  - –†–µ–≥—É–ª—è—Ä–Ω–∞—è —Ä–æ—Ç–∞—Ü–∏—è (—Ä–∞–∑ –≤ 3-6 –º–µ—Å—è—Ü–µ–≤)  
- **–î–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å–∞–º**:  
  - –°–µ—Ç–µ–≤–æ–π –ø—É—Ç—å –∫ MSI: —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ –¥–ª—è `Domain Computers`  
  - –°–∫—Ä–∏–ø—Ç: —Ö—Ä–∞–Ω–∏—Ç—å –≤ –∑–∞—â–∏—â–µ–Ω–Ω–æ–π SYSVOL  
- **–ó–∞—â–∏—Ç–∞ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**:  
  - –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å —Ç–æ–∫–µ–Ω –≤ Git!  
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–ª—è GPO  

### ‚ö†Ô∏è –¢–∏–ø–æ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
| –û—à–∏–±–∫–∞ | –†–µ—à–µ–Ω–∏–µ |
|--------|---------|
| `403 Forbidden` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–∞ |
| `Host already exists` | –û–∂–∏–¥–∞–µ–º–æ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞–ø—É—Å–∫–µ |
| `MSI not found` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å `\\—Å–µ—Ä–≤–µ—Ä\...` –¥–ª—è `COMPUTER$` |
| `Port 10050 blocked` | –û—Ç–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç –≤ –±—Ä–∞–Ω–¥–º–∞—É—ç—Ä–µ |
| `Template not found` | –£—Ç–æ—á–Ω–∏—Ç—å –∏–º—è —à–∞–±–ª–æ–Ω–∞ –≤ Zabbix |
| `Access denied` | –ó–∞–ø—É—Å–∫–∞—Ç—å GPO –æ—Ç SYSTEM |

### üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
1. **–õ–æ–∫–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏**:  
   `C:\Windows\Temp\zabbix_script.log`  
   –§–æ—Ä–º–∞—Ç: `[2024-07-18 14:30:00] –°–æ–æ–±—â–µ–Ω–∏–µ`  

2. **–ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π**:  
   - –ò—Å—Ç–æ—á–Ω–∏–∫: `Zabbix Script`  
   - –ö–æ–¥ —Å–æ–±—ã—Ç–∏—è: `1` (–æ—à–∏–±–∫–∏)  

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Zabbix**:  
   - –ì—Ä—É–ø–ø–∞ —Ö–æ—Å—Ç–æ–≤: `$ZBX_HOSTGRP_NAME`  
   - –®–∞–±–ª–æ–Ω: `$ZBX_TEMPLATE_NAME`  

> **–î–ª—è –æ—Ç–ª–∞–¥–∫–∏ GPO**:  
> `gpresult /h report.html`  
> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ:  
> `Computer Configuration ‚Üí Policies ‚Üí Windows Settings ‚Üí Scripts ‚Üí Startup`  

### üí° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- **–ü–∞–∫–µ—Ç–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ**: –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Zabbix Discovery –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –∑–∞—á–∞—Å—Ç—É—é —É–¥–æ–±–Ω–µ–µ (–º–Ω–µ –Ω–µ –ø–æ–¥–æ—à–ª–æ)  

Copyright ¬© 2025 –ö–æ–¥–µ–ª—å–Ω–∏–∫ –ú–∞–∫—Å–∏–º –°–µ—Ä–≥–µ–µ–≤–∏—á (–û–û–û "–ì–µ–Ω—à—Ç–∞–±") | MIT License
